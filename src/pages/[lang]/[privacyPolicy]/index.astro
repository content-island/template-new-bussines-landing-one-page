---
import type { LanguageCode } from '@content-island/api-client';
import { LANGUAGES } from '#core/constans';
import Layout from '#layouts/Layout.astro';
import PrivacyPolicyComponent from '#pods/privacy-policy/PrivacyPolicy.astro';
import { getPrivacyPolicyMeta, getPrivacyPolicy } from '#pods/privacy-policy';

interface Props {
  params: {
    lang: LanguageCode;
    privacyPolicy: string;
  };
}

const { lang } = Astro.params as Props['params'];
const { title, description } = await getPrivacyPolicyMeta(lang);
const privacyPolicies = await Promise.all(
  LANGUAGES.map(async currentLang => ({
    lang: currentLang,
    ...(await getPrivacyPolicy(currentLang)),
  }))
);

const languagePaths = Object.fromEntries(privacyPolicies.map(({ lang, slug }) => [lang, `/${lang}/${slug}`])) as Record<
  LanguageCode,
  string
>;

export const getStaticPaths = async () =>
  Promise.all(
    LANGUAGES.map(async lang => {
      const { slug } = await getPrivacyPolicy(lang);

      return { params: { lang, privacyPolicy: slug } };
    })
  );
---

<Layout lang={lang} title={title} description={description} languagePaths={languagePaths}>
  <PrivacyPolicyComponent lang={lang} />
</Layout>
