---
import type { LanguageCode } from '@content-island/api-client';
import Footer from './components/Footer.astro';
import Header from './components/Header.astro';

import '../css/global.css';
import { getGeneral, getTheme } from './api';

interface Props {
  lang: LanguageCode;
  title?: string;
  description?: string;
  languagePaths?: Partial<Record<LanguageCode, string>>;
}

const { lang, title, description, languagePaths } = Astro.props as Props;

const { favicon } = await getGeneral(lang);
const theme = await getTheme(lang);

const themeVariables = `
  --color-primary: ${theme.colorPrimary};
  --font-name-body: ${theme.fontBody.name};
  --font-name-title: ${theme.fontTitle.name};
`;

const fontTitleLink = theme.fontTitle.url
  ? theme.fontTitle.url
  : 'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap';

const fontBodyLink = theme.fontBody.url
  ? theme.fontBody.url
  : 'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&display=swap';
---

<!doctype html>
<html lang={lang} style={themeVariables}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href={favicon.url} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href={fontTitleLink} rel="stylesheet" />
    <link href={fontBodyLink} rel="stylesheet" />
    <link rel="stylesheet" href="/src/css/global.css" />
  </head>
  <body class="flex min-h-screen flex-col">
    <Header lang={lang} />
    <main class="flex-1">
      <slot />
    </main>
    <Footer lang={lang} languagePaths={languagePaths} />
  </body>
</html>

<script>
  // Theme toggle logic
  const themeToggle = document.querySelector('.theme-toggle');
  const html = document.documentElement;

  // Check for saved theme preference or default to 'light'
  const currentTheme = localStorage.getItem('theme') || 'light';
  html.setAttribute('data-theme', currentTheme);

  themeToggle?.addEventListener('click', () => {
    const theme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    html.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  });

  // Mobile menu toggle
  const menuToggle = document.querySelector('.menu-toggle');
  const navMenu = document.querySelector('.nav__menu');
  const body = document.body;

  menuToggle?.addEventListener('click', () => {
    navMenu?.classList.toggle('nav__menu--active');
    menuToggle?.classList.toggle('menu-toggle--active');
    body.classList.toggle('menu-open');
  });

  // Close menu when clicking on a link
  document.querySelectorAll('.nav__link').forEach(link => {
    link.addEventListener('click', () => {
      navMenu?.classList.remove('nav__menu--active');
      menuToggle?.classList.remove('menu-toggle--active');
      body.classList.remove('menu-open');
    });
  });
</script>
