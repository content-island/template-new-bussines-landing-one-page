---
import type { LanguageCode } from '@content-island/api-client';
import Footer from './components/Footer.astro';
import Header from './components/Header.astro';

import '@fontsource-variable/geologica/index.css';
import '@fontsource-variable/inter/index.css';
import '../css/global.css';
import { getGeneral } from './api';

interface Props {
  lang: LanguageCode;
  title?: string;
  description?: string;
  languagePaths?: Partial<Record<LanguageCode, string>>;
}

const { lang, title, description, languagePaths } = Astro.props as Props;

const { favicon } = await getGeneral(lang);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href={favicon.url} />
    <link rel="stylesheet" href="/src/css/global.css" />
  </head>
  <body class="flex min-h-screen flex-col">
    <Header lang={lang} />
    <main class="flex-1">
      <slot />
    </main>
    <Footer lang={lang} languagePaths={languagePaths} />
  </body>
</html>

<script>
  // Theme toggle logic
  const themeToggle = document.querySelector('.theme-toggle');
  const html = document.documentElement;

  // Check for saved theme preference or default to 'light'
  const currentTheme = localStorage.getItem('theme') || 'light';
  html.setAttribute('data-theme', currentTheme);

  themeToggle?.addEventListener('click', () => {
    const theme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    html.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  });

  // Mobile menu toggle
  const menuToggle = document.querySelector('.menu-toggle');
  const navMenu = document.querySelector('.nav__menu');
  const body = document.body;

  menuToggle?.addEventListener('click', () => {
    navMenu?.classList.toggle('nav__menu--active');
    menuToggle?.classList.toggle('menu-toggle--active');
    body.classList.toggle('menu-open');
  });

  // Close menu when clicking on a link
  document.querySelectorAll('.nav__link').forEach(link => {
    link.addEventListener('click', () => {
      navMenu?.classList.remove('nav__menu--active');
      menuToggle?.classList.remove('menu-toggle--active');
      body.classList.remove('menu-open');
    });
  });
</script>
